# TODO (RKLLM Agent CLI)

## 優先度: 高
- [x] プロンプト組み立ての分離・簡素化: system/user/context/tools の4段を明示し、<files>は参照専用、出力は `<file path="...">` のみを許可。
- [x] ファイル入出力パイプラインの固定: 「指定されたファイルを読む → 翻訳/概要/追記などを行う → 指定された出力ファイルに保存」フローを実装。入力と同一内容の書き込み禁止、出力ターゲット不明時は保存しない。
- [x] MCPツールの取り扱い整理: デフォルト非表示（短縮版/全文は環境変数で切替）、ローカル書き込み優先を明文化。
- [x] 実機確認: LLM が入力内容を変換したうえで出力しているか（入力そのままを書かないこと）、複数出力ターゲット指示を含めて動作検証。

## 優先度: 中
- [x] 上書き確認フロー: `--confirm-writes` オプションで全書き込み前に確認可能にする。
- [x] プロンプト送信前プレビュー: `--preview-prompt` と `RKLLM_DEBUG_PROMPT` で送信内容を確認できるようにする。
- [ ] ファイル出力フォーマットの一本化: `<file path="...">` を正とし、ブラケット形式は互換扱いに整理。実装とドキュメントを同期。
- [ ] Qwen/Gemma 以外のモデルテンプレの検討と docs 追記（RK3588 向け推奨設定の補足）。

## 優先度: 低
- [ ] プロンプトプレビュー出力の整形（長さのみ表示/サマリ表示などのトグル整理）。
- [ ] MCPツールのみ使う運用ガイドの追加（tool-only モードの best practice）。***

## 新規タスク（入力まわりリファクタ準備）
- [ ] 行編集ライブラリ導入検討（Crossterm生入力をやめる）: reedline / rustyline などで全角・絵文字・折り返し対応、任意位置改行挿入（Shift+Enterが届かない端末向けに Ctrl/Alt+Enter などのフォールバックキー設定）、左右移動・Backspaceの安定動作、ちらつき抑制を満たすこと。
- [ ] 端末の拡張キーレポート可否の確認とフォールバック設計: Shift+Enterが修飾付きで届かない環境に備え、改行挿入用代替キーと設定オプションを決める。***
