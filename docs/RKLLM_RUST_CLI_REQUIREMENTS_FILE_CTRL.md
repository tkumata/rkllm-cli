# RKLLM CLI ファイル操作機能 要件書

## 概要

RKLLM CLI に、Claude Code や Gemini CLI のような対話中のファイル読み書き機能を追加する。

## 目標

対話中にユーザーが自然言語で指示することで、ファイルの読み書きができる CLI を実現する。

---

## 機能要件

### 1. ファイル読み込み機能

#### 1.1 基本動作

- ユーザーが対話中にファイルパスを含む質問をする
- CLI 側でファイルパスを検出し、ファイルを読み込む
- ファイル内容をプロンプトに組み込んで LLM に送信
- LLM が内容を理解して応答する

#### 1.2 検出パターン

以下のような入力からファイルパスを検出：

```
例1: "src/main.rs を読んでコメントを追加して"
例2: "README.md の内容を要約して"
例3: "このファイル ./config.toml を確認して"
例4: "Cargo.toml と src/lib.rs を見て依存関係を説明して"
```

#### 1.3 対応ファイル形式

- テキストファイル全般（.txt, .md, .rs, .py, .toml, .json, etc.）
- UTF-8 エンコーディング
- バイナリファイルは除外

#### 1.4 パス解決

- 相対パス：実行ディレクトリからの相対パス
- 絶対パス：そのまま使用
- `~`（ホームディレクトリ）の展開をサポート

#### 1.5 エラーハンドリング

- ファイルが存在しない場合：ユーザーに通知して LLM にも伝える
- 読み込み権限がない場合：エラーメッセージを表示
- ファイルサイズが大きすぎる場合：警告または制限（例：1MB 以上）

### 2. ファイル書き込み機能

#### 2.1 基本動作

LLM の応答から「ファイル作成・編集が必要」という指示を検出し、実際にファイルを書き込む。

#### 2.2 検出方法（案）

LLM の出力に特定のマーカーを含めることで検出：

```
[CREATE_FILE: src/example.rs]
\`\`\`rust
fn main() {
    println!("Hello");
}
\`\`\`
[END_FILE]
```

または

```xml
<file path="src/example.rs">
fn main() {
    println!("Hello");
}
</file>
```

#### 2.3 安全性

- 既存ファイルの上書き前に確認プロンプトを表示
- デフォルトでは実行ディレクトリ配下のみ書き込み可能
- システムディレクトリへの書き込みを制限

#### 2.4 動作例

```
> src/utils.rs にヘルパー関数を作って
```

